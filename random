sudo tee /opt/setup_target.sh << 'SETUP'
#!/bin/bash
echo "=== Setting up RvB Target Environment ==="

# Web server with vulnerable config
sudo mkdir -p /var/www/html/{admin,.secret,includes}

sudo tee /var/www/html/includes/config.php << 'EOF'
<?php
// Database configuration - TODO: Move to env vars!
$db_host = 'localhost';
$db_user = 'webapp';
$db_pass = 'Str0ngP@ss2024!';
$db_name = 'corporate';
?>
EOF

sudo tee /var/www/html/admin/.login.php.bak << 'EOF'
<?php
// Old login - admin:TechCorp2024!
?>
EOF

# Database with passwords in plaintext
sudo mysql << 'SQLEOF'
DROP DATABASE IF EXISTS corporate;
CREATE DATABASE corporate;
USE corporate;
CREATE TABLE customers (id INT PRIMARY KEY, name VARCHAR(100), ssn VARCHAR(20));
INSERT INTO customers VALUES (1, 'John Smith', '123-45-6789');
CREATE TABLE secrets (id INT PRIMARY KEY, flag VARCHAR(100));
CREATE TABLE users (id INT PRIMARY KEY, username VARCHAR(50), password VARCHAR(100));
INSERT INTO users VALUES (1, 'admin', 'TechCorp2024!'), (2, 'webapp', 'Str0ngP@ss2024!');
DROP USER IF EXISTS 'webapp'@'localhost';
CREATE USER 'webapp'@'localhost' IDENTIFIED BY 'Str0ngP@ss2024!';
GRANT ALL ON corporate.* TO 'webapp'@'localhost';
FLUSH PRIVILEGES;
SQLEOF

# Samba IT share with passwords
sudo mkdir -p /srv/samba/{shared,confidential,IT}
sudo tee /srv/samba/IT/server_passwords.txt << 'EOF'
=== IT Server Credentials ===
Web SSH: webadmin / W3bAdm1n!
Database: webapp / Str0ngP@ss2024!
Backup: backup / BackupUser99
EOF
sudo chmod -R 755 /srv/samba

# Bomb planting script
sudo tee /opt/plant_bomb.sh << 'BOMBSCRIPT'
#!/bin/bash
SERVICE=$1
DEFUSE_CODE=$2
FUSE_MIN=${3:-5}
BOMB_FILE="/tmp/.bomb_${SERVICE}.txt"
cat > "$BOMB_FILE" << EOF
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ðŸ’£ TIME BOMB DETECTED ðŸ’£             â•‘
â•‘  Target: $SERVICE                     â•‘
â•‘  DEFUSE CODE: $DEFUSE_CODE            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
chmod 644 "$BOMB_FILE"
echo "Bomb planted"
BOMBSCRIPT
sudo chmod +x /opt/plant_bomb.sh

echo "=== Setup Complete ==="
SETUP

sudo chmod +x /opt/setup_target.sh
sudo /opt/setup_target.sh
